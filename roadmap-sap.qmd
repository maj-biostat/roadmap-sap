---
title: Statistical Analysis Plan
subtitle: |
    ROADMAP: RandOmised Arthroplasty infection worlDwide Multidomain Adaptive Platform trial
description: |
    Investigator initiated, Randomised Embedded Multifactorial Adaptive Platform (REMAP) trial, conducted across multiple hospitals in several regions of the world.
date: last-modified
date-format: "D MMMM YYYY"
author: 
  - name: Mark Jones
    id: mj
    email: mark.jones1@sydney.edu.au
  - name: James Totterdell
    id: jt
    email: james.totterdell@sydney.edu.au
version: 0.1
sponsor: University of Newcastle, NSW, Australia
protocol-number: Version 1.1  01AUG2024
registration: todo
hrec: todo
ci1: Professor Joshua Davis  
ci2: Professor Laurens Manning
editor: source
bibliography: etc/refs.bib
csl: etc/elsevier-harvard.csl
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE
)
```

```{r, echo = F}
#| echo: false

# uml digs
library(nomnoml)
library(ggplot2)
suppressPackageStartupMessages(library(data.table))
library(tibble)
library(kableExtra)
suppressPackageStartupMessages(library(qs))
library(git2r)
```

{{< pagebreak >}}

::: summary
|     |        |
|:----|:------------|
|Study title:  |  ROADMAP: RandOmised Arthroplasty infection worlDwide Multidomain Adaptive Platform trial |
|Intervention: |  Surgery type, backbone antibiotic duration, extended prophylaxis, antibiotic type |   
|Study design:  |   Randomised Embedded Multifactorial Adaptive Platform trial | 
|Sponsor:  |    University of Newcastle, NSW, Australia | 
Protocol: |  Version 1.1  01AUG2024 |
|Registration:  |    TODO | 
|HREC:  |   TODO | 
|Study date of first consent:  |   TODO | 
|Principal coordinating investigators:  |   Professor Joshua Davis  and Professor Laurens Manning | 
:::

<!-- 
Note that the above relies on the pandoc extension implemented in the lua file 
in the etc directory. It additionally relies on the presence of a custom style
in word called study summary. It will currently only work for word (because I
cannot be bothered to implement it in anything else at the moment).
-->


{{< pagebreak >}}

# Version history {.unlisted .unnumbered}

| Version    |   Date     | Change    |   Reason     |
|:----|:------------|:----|:------------|
| 0.1 | 9/2024 | First version | N/A |


{{< pagebreak >}}

# Repository status {.unlisted .unnumbered}

```{r}
#| echo: false
repo <- repository(path = ".")
summary(repo)
```


{{< pagebreak >}}

# Introduction

ROADMAP is a project for evaluating the efficacy of a range of interventions used in the treatment of prosthetic joint infection (PJI) and is primarily intended to inform clinical decision making at point of care. 
It is an international study run in Australia, New Zealand, Canada and the UK with multiple partners from the academia sector and is intended to be a perpetual platform, implying a single Master Protocol dictating the study conduct. 
Each domain-level combination of interventions that enter the platform study is documented within separate Domain Specific Appendix (DSA) to the Master Protocol. 
Conclusions and reports will be produced separately even though some placebo treated participants may contribute to several of the reports.
All DSAs will be evalauated under a single model specification.


## Background motivating research question(s)

ROADMAP is motivated by several high-level questions related to the management of artificial joint infections^[Italics in the bullet list indicate updates that might be required for protocol.], specifically:

1. For *late-acute* post-operative infections, is it better to keep the existing artificial joint and clean the infection or to replace the joint entirely?
2. What is the most effective duration of backbone antibiotics after *one-stage revision* surgery?
3. Is it better to include rifampicin in the backbone antibiotic treatment regimen?

Each of these will be evaluated with reference to the primary outcome at 12 months from platform entry with the composite outcome defined as the co-occurrence of

1. Alive
2. Clinical cure (no microbiological evidence of infection)
3. No ongoing use of antibiotics for the index joint 
4. The destination prosthesis is in place after the initial management strategy is complete

The absence of any of the above elements implies treatment failure.
More detail on the primary outcome definition is given in the protocol.

## Objectives, endpoints and estimands

The main objective of the ROADMAP trial is to examine the effect of a range of interventions in patients with PJI (defined by the eligibility criteria) on treatment success where 
this is defined as the patient being alive with clinical cure, not taking antibiotics for PJI and with the destination prothesis in place and is assessed at 12 months.
@tbl-obj provides a summary of the domain-level objectives and further detail can be found in the protocol.

| Domain | Objective    |   Endpoint     |
|:----|:----|:------------|
| Surgical | Determine whether revision (one or two-stage) is more effective than debridement in curing prosthetic joint infections in late-silo units.  | Treatment success at 12 months (alive, clinical cure, no antibiotics for PJI, destination prothesis in place). |
| Antibiotic duration | Determine whether 6 weeks of backbone antibiotic is non-inferior to 12 weeks in curing prosthetic joint infections in units receiving one-stage revision. | Treatment success at 12 months. |
| Extended prophylaxis | Determine whether 12 weeks of ext-prophylaxis is more effective than none in curing prosthetic joint infections in units receiving two-stage revision. | Treatment success at 12 months. |
| Antibiotic choice | Determine whether the addition of rifampicin is more effective than not in curing prosthetic joint infections in units where one or more of the causative organisms is Gram-positive of interest (or infection is culture negative). | Treatment success at 12 months. |

: ROADMAP domain-level analytic objectives {#tbl-obj tbl-colwidths="[20,45,35]"}


The estimands are detailed in the protocol (references below correspond to those in the protocol).
Estimands emphasise what is being estimated rather than how the estimation is undertaken.
Below we add detail to the specification provided in the protocol with a focus on the interventions, population summaries and intercurrent events in an attempt to further clarify what is being estimated.


### Primary estimand {#sec-html-tables}

See estimand A.1 in the master protocol, which has been extended to classify each comparison.
A.1 approximates a *"pure-ITT"* approach in that all ICEs are currently handled by a treatment policy strategy.
However, the outcome definition encapsulates a composite strategy for death and replacement of desination prothesis ICEs.
Nevertheless, the additional detail is provided as it may be useful for context as the treatment policy strategy has particular consequences, especially when non-inferiority is a quantity of interest.

::: {.callout-note}
While death (occurring prior, during or after the occurrence of the intervention) would ordinarily be considered an intercurrent event in this setting, it has been accounted for by its inclusion in the primary outcome definition, i.e. we implicitly adopt a composite strategy for death.
Similarly, secondary or rescue surgery leading to the removal of a prosthetic is accounted for by its inclusion in the primary outcome definition, again being handled via a composite strategy.  

Each of the treatment specific ICEs detailed may occur for a given unit in isolation or in conjunction with ICEs associated with treatment arms in other domains, e.g. a patient switches from DAIR to revision due to loose joint and discontinues extended prophylaxis due to adverse reaction.
In such instances, the ICEs are still handled by their applicable strategy for the estimand under consideration.
However, in instances where multiple ICEs (e.g. adverse event followed by discontinuation due to relocation) occur within a given unit for a given treatment, the approach for handling them may be vaguely defined.
:::

#### Estimand A.1.1 (surgical intervention)

In all cases, interest is in the main effects.

**High-level overview:**

The estimand considers the effect of removing the infected joint relative to cleaning and leaving in place on treatment success at 12 months.

**Treatment condition:**

The protocol definitions of the interventions are provided in the DSA for the Surgical strategy domain (late acute silo).
These definitions give the detail on the setting and what needs to occur for each interventions for it to be considered to align with the protocol.
For example, at a minimum and amongst other things, debridement and implant retentioin (DAIR) must include an open approach, exchange of modular components.
The randomised treatment arms comprise DAIR and revision with the clinician permitted to self-select the type of revision (one or two-stage) to be used when a patient is assigned to the revision group.
Likely intercurrent events and the approaches used to handle them are summarised in @tbl-ice1 where the treatment policy ICE strategy aims to establish the effect of initially randomised treatment.

::: {.callout-note}
Other ICEs are probably relevant such as withdrawal due to clinician perspective on patient best interest with regards to involvement in roadmap. However,  it may be acceptable to continue to collect data on such a patient, in which case the treatment policy would still be acceptable. Deviations from assigned treatment in terms of variations in procedures per the protocol definitions but not leading to switching would also constitute an ICE that impact the interpretation of the treatment effects. An example of this may be secondary surgery that does not lead to replacement of prosthetic, i.e. not handled via the composite strategy. Another example may be deviation from any protocol timings (are there any, e.g. is a dair at 1 week after randomisation the same as a dair 10 weeks after randomisation?) for the surgery to take place. These would also be handled via treatment policy.
:::

| ID | Arm |   ICE     |  Class | Strategy | 
|:----:|:----|:------------|:------------|:------------|
| A.1.1(i1) | DAIR  | If prosthesis is found to be loose when the joint is opened, the surgeon would routinely override allocation and do a revision. | Switchover | Treatment policy |
| A.1.1(i2) | Revision  | If the patient becomes clinically unstable prior to or during the operation, the surgeon may abandon the attempt at revision and revert to a DAIR. | Switchover | Treatment policy |
| A.1.1(i3) | Revision  | If one or more components of the prosthesis are too difficult to remove, the surgeon may abandon the attempt at revision and revert to a DAIR. This is more likely with a non-cemented hip than with a cemented hip or a knee. | Switchover | Treatment policy |

: Surgery domain intercurrent events {#tbl-ice1 tbl-colwidths="[8,8,50,17,17]" .striped}

Under a treatment policy strategy, the treatment regimen considered is, in fact, the initial randomized treatment with discontinuation or switch of treatment and/or alterations in background therapy, changes in medication and rescue therapy at any point in time.
As such, this ICE strategy is not associated with a specific single treatment regimen, but rather yields a view of the average effects of a mix of regimens aligned to those that commonly occur in practice when undertaking DAIR or revision.

Switchover will not generally result in the outcome variable being missing (assuming the patient followup continues to completion) but does affect the interpretation of the result due to dilution of the treatment effect.
For example, in a two-arm trial, if the majority of units assigned to the first treatment switched over to the second treatment and none of the units assigned to the second treatment switched then an ITT/treatment policy approach would be comparing groups of units that effectively received the same treatment.

**Population summary:**

The population-level summary measure is the conditional odds ratio for revision relative to DAIR.

**Data useful for estimand:**

It is important that units continue to be followed up after the occurrence of an ICE.

**Main estimator:**

A single Bayesian multivariable (factorial) logistic model is used to characterise unit responses for the primary outcome across all domains with further detail provided in later sections.

Given the structure of the study, specifically, the desire to permit clinicians free choice of revision type and the dependency between specific revision types and entry into the antibiotic duration and extended prophylaxis domain, the population-level summary is constructed as a weighted conditional log odds ratio where the weights adopted would be those observed in the study sample.

**Missing data:**

Missing data is possible/inevitable(?) due to inability to identify clinical records, formal requests to completely withdraw from the study (including use of data), loss to follow up due to relocation.
Additionally, components of the composite outcome may not be available in the clinical records (e.g. ongoing use of antibiotic).
Missingness is assumed to likely be low and at random across all variables and variable components.
Under these assumptions, missingness imputation is not technically required and a complete-case analysis will yield unbiased estimates providing the missingness is not simultaneously dependent on the outcome and exposure.
As such, imputation will not be adopted for the primary outcome variable.
Where it exists, missingness in covariates will be addressed by deduction (where possible) or fixed imputation scheme (if reasonable).

**Sensitivity:**

Tipping point sensitivity analysis may be considered.
Multiple imputation may be implemented.

#### Estimand A.1.2 (antibiotic duration intervention)

**High-level overview:**

The estimand considers the effect of the duration of backbone antibiotics on treatment success at 12 months, specifically whether 6 weeks of backbone antibiotic is non-inferior to 12 weeks in patients receiving one-stage revision.

**Treatment condition:**

The protocol definitions of the interventions are provided in the DSA for the Antibiotic duration domain following single stage revision.
Potential intercurrent events and the approaches used to handle them are summarised in @tbl-ice2 where the treatment policy ICE strategy aims to establish the effect of initially randomised treatment.

| ID | Arm |   ICE     |  Class | Strategy | 
|:----:|:----|:------------|:------------|:------------|
| A.1.2(i1) | 6 wk  | If patient has slow improvement, recrudescence of infection or need to return to theatre then clinicians may choose to prolong antibiotic therapy. | Extended therapy | Treatment policy |
| A.1.2(i2) | 12 wk  | Adverse effects of antibiotics or patient discharge/relocation may lead to early termination of therapy. | Discontinuation | Treatment policy |

: Antibiotic duration domain intercurrent events {#tbl-ice2 tbl-colwidths="[8,8,50,17,17]" .striped}

Extended therapy in the 6 week group would make the responses more similar to the 12 week group leading to increase likelihood of non-inferiority decision, i.e. conclusions may anti-conservative. 
Equally, early termination in the 12 week group would make the responses more similar to the 6 week group.

**Population summary:**

The population-level summary measure is the conditional odds ratio for 6 weeks backbone antibiotic relative to 12 weeks.

Other sections are as above.



#### Estimand A.1.3 (extended prophylaxis intervention)

**High-level overview:**

The estimand considers the effect of the extended prophylaxis on treatment success at 12 months, specifically whether 12 weeks of backbone antibiotic is more effective than none following the second stage of the revision procedure in patients receiving two-stage revision.

**Treatment condition:**

The protocol definitions of the interventions are provided in the DSA for the Antibiotic duration domain (extended prophylaxis) following a two-stage revision
Potential intercurrent events and the approaches used to handle them are summarised in @tbl-ice3 where the treatment policy ICE strategy aims to establish the effect of initially randomised treatment.

| ID | Arm |   ICE     |  Class | Strategy | 
|:----:|:----|:------------|:------------|:------------|
| A.1.3(i1) | None  | If the patient has slow improvement, recrudescence of infection or need to return to theatre then clinicians may choose to prolong antibiotic therapy. | Extended therapy | Treatment policy |
| A.1.3(i2) | None  | If the patient shows late positive culture, they would become ineligible and would receive additional backbone antibiotic. | Extended therapy | Treatment policy |
| A.1.3(i3) | 12 wk  | Adverse effects of antibiotics or patient discharge/relocation may lead to early termination of therapy. | Discontinuation | Treatment policy |

: Extended prophylaxis domain intercurrent events {#tbl-ice3 tbl-colwidths="[8,8,50,17,17]" .striped}

::: {.callout-note}
Clarify A.1.3(i2), is it additional backbone ab? Would they continue to receive ext prophylaxis even though now ineligible?
:::

Extended therapy in the 6 week group would make the responses more similar to the 12 week group leading to increase likelihood of non-inferiority decision, i.e. conclusions may anti-conservative. 
Equally, early termination in the 12 week group would make the responses more similar to the 6 week group.

**Population summary:**

The population-level summary measure is the conditional odds ratio for 12 weeks extended prophylaxis relative to none.

Other sections are as above.


#### Estimand A.1.4 (choice intervention)

**High-level overview:**

The estimand considers the effect of the antibiotic choice on treatment success at 12 months, specifically whether the use of rifampicin is more effective than none for domain eligible units.

**Treatment condition:**

The protocol definitions of the interventions are provided in the DSA for the Antibiotic choice domain.
Potential intercurrent events and the approaches used to handle them are summarised in @tbl-ice4 where the treatment policy ICE strategy aims to establish the effect of initially randomised treatment.

| ID | Arm |   ICE     |  Class | Strategy | 
|:----:|:----|:------------|:------------|:------------|
| A.1.4(i1) | None  | If the patient has slow improvement (e.g. 1-4 weeks post operatively), clinicians may add rifampicin despite assignment. | Switchover | Treatment policy |
| A.1.4(i2) | Rifampicin  | If the site pharmacy runs out of or does not have any rifampicin in stock may lead to early termination or non-receipt of therapy. | Discontinuation or non-receipt | Treatment policy |
| A.1.4(i3) | Rifampicin  | Adverse effects of rifampicin (intractable nausea, severe hepatitis) may lead to early termination of therapy. | Discontinuation | Treatment policy |

: Choice domain intercurrent events {#tbl-ice4 tbl-colwidths="[8,11,50,17,15]" .striped}

::: {.callout-note}
Clarify A.1.4(i1), would this still constitute switchover after the delayed start (or rescue)?
Clarify A.1.3(i2), is it additional backbone ab? Would they continue to receive ext prophylaxis even though now ineligible?

As with other domains, patient discharge/relocation is probably relevant.
:::

Both discontinuation/non-receipt of rifampicin or addition of rifampicin to the the control group make groups more similar than they otherwise would be. 

**Population summary:**

The population-level summary measure is the conditional odds ratio for rifampicin relative to none.

Other sections are as above.

## Study design

ROADMAP is an investigator-initiated, phase IV (open label), multicentre, pragmatic, randomised embedded multifactorial adaptive platform (REMAP) formulated to investigate the efficacy of multiple study interventions simultaneously in cohorts of patients with confirmed or likely prosthetic joint infection in a large joint (hip, knee) with no age restriction.
ROADMAP includes the development of a registry, however, that will not be discussed here.

Bayesian methods were selected for its inherent model flexibility, ease of uncertainty quantification and incorparating adaptive elements, regularisation of parameter estimates and simplicity in interpretation.

Initial treatment modality groups (domains) examine surgery type, antibiotic duration, extended prophylaxis and antibiotic choice.
New interventions are permitted to enter into existing domains and new domains are also permitted subject to steering committee and ethics review.

ROADMAP will be conducted sequentially (cohorts of 500 patients) with decision rules evaluated on parameter estimates of interest, driving domain-level stopping rules and platform conclusions.
Early stopping is permitted under pre-specified conditions, specifically for superiority, non-inferiority and futility as applicable to the given domain.

### Randomisation

Units will be randomised (under fixed complete randomisation, i.e. non-adaptive and without restriction through blocking or stratification etc) to one arm within each domain for which they are eligible [@Rosenberger2016].
As entry into the duration domains are dependent on the status of the surgical intervention, some subtleties arise.
For example, only units in receipt of one-stage revision can enter into randomised assignment for antibiotic duration and which prevents entry into extended prophylaxis.
Similarly, only units in receipt of two-stage revision can enter into randomised assignment for extended prophylaxis. 
A practical way to operationalise this is to simply randomise each unit to all available domains and then reveal the allocation as necessary.
For example, a unit within any of the early, late or chronic silo would be allocated interventions for all domains.
However, for early silo units, the surgical interventions are irrelevant and so never revealed, the antibiotic duration interventions would only be revealed if one-stage was received, the extended prophylaxis would only be revealed if two-stage was received and so on.

### Sample size

The initial trial funding and infrastructure has sufficient resources to enrol up to 2,500 participants into the platform.
Thus, the sample size is initially constrained by the current resources and the desired structure, however, the study is intended to be perpetual and will seek funding to ensure recruitment beyond the initial sample size if necessary.
Implications of the initial sample size on the amount of uncertainty that can be resolved under assumptions about the cohort population, the present design and assumed effects have been evaluated by simulation, see results later.

### Data management

An overview is provided in the Master Protocol.
However, we note that the data storage approach will be decomposed into redcap components and (out-sourced) spiral platform components, the latter also being responsible for the randomisation processes.

::: {.callout-note}
Check on how this functionality is being decomposed. 
What are the redcap parts and what belongs to spiral?
:::

# Statistical methods

## Analysis sets

The intent to treat (ITT) principle covers what units to include and what data to include on each unit.
A strict interpretation of ITT demands collection and analysis of all data, but deviations from this are routinely accepted.

Estimand A.1.* approximates an ITT view and the analysis population used for this estimand will include all units that were randomised and revealed to at least one of the domain-level interventions and have passed the primary endpoint of 12-months with their primary endpoint status known or known to be missing.
Per the treatment policy strategy, all randomised patients will be included and analysed according to the regimen to which they were initially allocated irrespective of any deviations from this regimen or any other protocol deviations.

Participants that have reached follow up, but for whom information has not yet been gathered will be treated as missing until the data has been entered.
Participants who have been randomised, but have not yet reached the primary endpoint, will be excluded.

## Subgroups {#sec-subgroups}

Stratification of effects to subgroup populations enable effect heterogeneity to be explored, but come at the increased risk of instability, bias and false positives.
Subgroup populations have been identified in the various appendices but are duplicated here in summary form for convenience, @tbl-subgrp-1.

```{r}
#| echo: FALSE
#| label: tbl-subgrp-1
#| tbl-pos: H
#| tbl-cap: "Subgroup populations"

d_tbl <- tribble(
  ~ Domain, ~ Subgroup, 
  "Surgical", "Site of infection by joint (hip/knee)",
  "", "Duration of symptoms at domain entry in days", 
  "", "At least one causative organism is S. aureus versus not", 
  "", "Serum C-reactive protein (CRP) at platform entry >100 versus <=100", 
  "", "Time from implantation of the index prosthesis to domain entry in days", 
  "", "In those who are allocated to revision surgery: one stage versus two stage revision", 
  "Antibiotic duration", "Silo is early, late acute or chronic",
  "", "At least one causative organism is known at the time of domain eligibility assessment to be Staphylococcus aureus versus not",
  "", "revision procedure comprised all elements of an ‘ideal’ procedure vs.  not",
  "Extended prophylaxis", "Silo membership", 
  "", "At least one causative organism is known at the time of domain eligibility assessment to be Staphylococcus aureus versus none", 
  "", "Duration between first-stage and reimplantation procedure", 
  "", "Duration of antibiotic treatment between first-stage and reimplantation procedure", 
  
  "Antibiotic choice", "Type of surgery (DAIR, one-stage, two-stage)", 
  "", "At least one causative organism is a Staphylococcus (any species) versus none"
  )

kableExtra::kbl(
  d_tbl, format = "latex", align = c("l", "l", "l", "l"), escape = FALSE,
  col.names = c("Domain", "Subgroup population")) |>
  kable_paper("hover", full_width = F) |>
  column_spec(2, width = "13cm") |>
  kable_styling(latex_options = "scale_down") 
#  see above comment - do not use hold_position, use tbl-pos instead
#   kable_styling(latex_options = "hold_position")
```



## Description


A CONSORT diagram will will be provided to detail patient progression showing:

+ participants screened
+ participants eligible (giving reasons for ineligibility)
+ participants consented
+ participants entering into randomised treatment (revealed) by domain and intervention
+ participants withdrawing from study
+ participants reaching 12-month endpoint

Recruitment numbers will be reported by region and site and intervention availability by domain will be presented, again by site.

Protocol deviations and the occurrence of intercurrent events will be summarised by domain and intervention.
Baseline demographics will be provided by domain and intervention.

## Sequential analyses

Interim analyses will be run over the life of the trial to evaluate pre-specified decision criteria.
Analyses will start once 500 participants have reached the primary endpoint and every 4 months thereafter.

::: {.callout-note}
Need to revisit this timing.
I think it is probably more operationally practical to run interims on a regular timing rather than for fixed sample size.
:::

The analysis will focus solely on the primary outcome (with subgroup analyses run conditional on futility rules being triggered, see later) and will follow the approach detailed in @sec-primary-analysis.
Only the analytical group responsible for providing the interim analysis results to the DSMC will be unblinded to the individual treatment group assignments. 

## Analysis approach

Analyses will be conducted within a Bayesian framework with a focus on the estimation of estimands as detailed earlier.
Parameter estimates will be computed via Markov chain Monte Carlo (MCMC) using Hamiltonian Monte Carlo (HMC).
Posterior summaries will be reported as posterior means and medians with 95% credible intervals.
Convergence will be assessed visually and with reference to appropriate statistics. 
Model fit will be considered with reference to posterior predictive checks. 

## Primary analysis {#sec-primary-analysis}

The primary analysis model for ROADMAP will adjust for silo, joint, preference for revision type, region, site, time period of recruitment and baseline characteristics, adopting the following form:

<!-- see the latex physics manual for vector va, vb notation -->
<!-- in brief, for greek letters you need the * -->

$$
\begin{aligned}
Y &\sim \text{Bernoulli}(p) \\
\text{logit}(p) &= \mu + \lambda_s + \rho_j + \phi_q + \sum_{d \in \mathcal{D}} \va{x}_{d}^\prime \va*{\beta}_{d} + \tau_t + \psi_r + \zeta_{z(r)} + \va{w}^\prime \va*{\gamma}
\end{aligned}
$$

<!-- alternatively for transpose use \va{x}_{d}^\top -->

where $Y$ is a binary variable representing unit level treatment success with probability $p$ and the linear predictor terms are as follows:

+ $\mu$	reference level log-odds of a successful outcome
+ $\lambda_s$ shift attributable to membership in silo $s$
+	$\rho_j$ shift attributable site of infection $j$
+	$\phi_q$ shift attributable to preference for type of revision surgery $q$
+	$\va*{\beta}_{d}$ shift attributable to each vector of treatment effects (including non-participation effects) as indicated by the row vector $\va{x}^\prime$ for domain $d$ in the set of available domains $\mathcal{D}$ 
+	$\psi_r$ shift attributable to region $r$ 
+	$\zeta_{z(r)}$ shift attributable to site $z$ nested within region $r$
+	$\tau_t$ shift attributable to randomisation period $t$
+	$\va*{\gamma}$ shift attributable to baseline characteristics as indicated by the row vector $\va{w}$


In order to estimate the treatment effects of interest we use g-computation as described in @sec-statistical-quantities.
Parameters estimates will be reported as point and interval summaries of the posterior.

### Priors

In general we will use weakly informative priors that will not overly constrain the results, but will  be consistent with the belief that extreme treatment effects are unlikely.

The prior for $\mu$ will be set to

$$
\mu \sim \text{Logistic}(0, 1)
$$

which is centred on zero with 90% of its mass between $\pm 3$ on the log-odds scale and uniform on the probability scale.

The priors for all main effects will be set to 

$$
(\lambda_s, \rho_j, \phi_q, \va*{\beta}_d, \va*{\gamma}) \sim \text{Normal}(0, 2.5)
$$

which are centred on zero with 90% of its mass between $\pm 3.3$ on the log-odds scale.

The baseline covariates in the model include

+ age
+ sex
+ ...

Noting that some domains may vary their active set of interventions over time, a first-order random walk will be used to model temporal variation in the background response which has the following structure

$$
\begin{aligned}
\tau_1 &= 0 \\
\tau_i &= \text{Normal}(\tau_{i-1}, \sigma_\tau) \quad \forall \ i > 1 \\
\sigma_\tau &\sim \text{Exponential}(1)
\end{aligned}
$$

with indexes aligned with analyses the $\tau_1$ term representing the most recent analysis.

::: {.callout-note}
Question - Would it be preferable/more sensible to model on a finer granularity, i.e. monthly, quarterly etc?
:::

The prior for region will be set as per the main effects detailed above with the first region fixed to zero. 
Site priors will be nested within region and set as 

$$
\begin{aligned}
\zeta_{z(r)} &\sim \text{Normal}(0, \sigma_\zeta) \\
\sigma_\zeta &\sim \text{Exponential}(1)
\end{aligned}
$$


The primary analysis model will be assessed for adequacy. 
Additional models (either simpler or more complex) may be investigated as part of checks of sensitivity, stability, and model fit. If any issues or concerns arise (for example, strong evidence of interactions across treatment domains), all changes or updates to the specified primary model will be documented and reported.

### Sensitivity analysis



## Subgroup analyses {#sec-subgroup-analyses}

Pre-specified subgroup analyses will be restricted to the primary analysis with exploratory subgroup analyses being discretionary.
The general approach will be to use the complete data, effectively incorporating first-order interactions within the relevant models via hierarchical models for each subgroup considered.
Analyses will be run for final reporting on each domain but also at interim analyses for the relevant domain-level subgroups if a futility decision is triggered with the latter analysis motivated by a prior belief in the possibility of material treatment effect heterogeneity.
Additionally, the researchers had a desire to mitigate the possibility of terminating entry into a domain for subgroups when the possibility of a positive outcome remained.

To address subgroups, the primary analysis model is revised such that the parameters in the linear predictor are split for all relevant groups.
For example, for evaluation of silo-specific effects, the revised linear predictor would take the following form:

$$
\begin{aligned}
\mu_s + \rho_{j,s} + \phi_{q,s} + \sum_{d \in \mathcal{D}} \va{x}_{d}^\prime \va*{\beta}_{d} + \tau_t + \psi_r + \zeta_{z(r)} + \va{w}_s^\prime \va*{\gamma_{s}}
\end{aligned}
$$

leaving time and site effects unstratified (along with terms where identification is infeasible).
For each of the main effects priors are converted to a hierarchical structure, for example for the surgical domain treatment effects:

$$
\begin{aligned}
(\va*{\beta}_{1,s}) &\sim \text{Normal}(\nu, \sigma_\nu) \\
\nu &\sim \text{Normal}(0, 2.5) \\
\sigma_\nu &\sim \text{Half-Normal}(0, 1)
\end{aligned}
$$

and with other main effects dealt with analogously.

<!-- minutes from 2024-09-09 -->

<!-- a.	Subgroups on joint: MJ: decision was to not look at heterogeneity in joint and make all decisions like assuming constant effects across joint in the interim analyses. At the interim analyses, do the subgroup analysis to look at heterogeneity by joint, and then have some sort of policy to put forward a case to the DSMC if needed as a way to see the differences in effects for various groups. LM: piano data doesn’t suggest there is a major difference in surgical outcomes between the two groups. Updated core protocol provides us the opportunity to leave one group open is there is inconsistency across the subgroups. MJ: operational perspective: make futility decision on surgery, look at sub-group specific effects of surgery and if one isn’t futile, there is the opportunity to continue randomising for those sub-groups. For any sub-groups in any of the domains (to avoid doing additional ethics amendment). Subgroups analysis only if the trigger is met.  MJ to consider -->


## Secondary analyses


### Desirability of outcome ranking
Ordinal regression, specifically cumulative logistic regression

### Patient-reported joint function (Oxford hip or knee score) at 12 months
Ordinal regression, specifically cumulative logistic regression

### Patient-reported quality of life (EQ5D5L) at 12 months
Linear regression

### Cost effectiveness
Bayesian simulation

### All-cause mortality at 12 months after platform entry
Hazard Model

### Clinical cure at 12 months after platform entry (as defined in the primary outcome)
Cause specific hazard model 

### Proportion no longer taking any antibiotics for the index joint at 12 months (as defined in the primary outcome)
Logistic regression

### Proportion in whom the destination prosthesis is still in place at 12 months (as defined in the primary outcome)
Logistic regression


### Microbiological relapse (Positive joint fluid or tissue culture for one or more of the index isolates between 100 days and 12 months after platform entry)
Cause specific hazard model

### Microbiological reinfection (Positive joint fluid or tissue culture with a different organism to the index isolates between 100 days and 12 months after platform entry)
Cause specific hazard model


### Time to joint registry captured revision procedure (within 24 months) from platform entry
Cause specific hazard model

## Missing data

### Primary outcome variable

Given the use of a composite outcome variable for the primary analysis, missingness in the composite elements can have differing implications to the interpretation of the outcome.
The composite is ascertained through the use of hospital databases, followup with healthcare provider and/or patient and/or data linkage with death registries.

Treatment failure is indicated if any of the four composite elements are observed to fail. That is, if we see any of death, absence of clinical cure, ongoing antibiotic use or destination prosthesis absent, then the unit is a failure, irrespective of whether the other elements of the composite are observed or missing.

Being alive, if direct evidence is missing, can be implied by the existence of any of observation of the other elements in the composite.
If all other elements are missing and death cannot be confirmed by other sources then the unit could either be alive or dead (e.g. they might have died out of country although this seems highly improbable).
More likely is that if a patient cannot be found in a death registry, then they are alive.

Clinical cure suggests that antibiotics would no longer be required and therefore could possibly be a proxy for antibiotic status if it were missing, although this would not be definitive.
Conversely, if the status of clinical cure were missing and antibiotic status were known, then we could possibly take the fact that antibiotics were not being received to imply clinical cure.

Destination prosthesis status could be not be implied by other elements of the composite and therefore the outcome status cannot be confirmed if it is missing.

### Covariates

When missing, some covariates can be completed by implication.
For example, if region is missing, but site is available, region is implied.

### Handling missingness

When missingness is completely at random or dependent on covariates, but not jointly dependent on the exposure and the outcome then, within logistic regression, the parameter estimate for the exposure is unbiased under complete case analysis [@hughes2019].
Therefore, a complete case approach will be used at the interims and final analysis.
A sensitivity analysis will be run for the final analysis using multiple imputation to imputate both the missing components of the composite primary outcome variable and missing covariate values.
Missing values will be imputed using a fully conditional specification via multivariate imputation by chained equations [@vanbuuren2011].

## Software

Analyses will be implemented in R and Bayesian models will be implemented in Stan with posterior distributions approximated using Markov chain Monte Carlo.

# Quantities of interest {#sec-statistical-quantities}

## Treatment effects

Interest lies primarily in the conditional effects of treatments under the various analyses.
In general, treatment is randomised so the groups are exchangeable (i.e. the potential outcome associated with any treatment is independent of the treatment that was assigned).
For the surgical domain, the choice of revision is left to the clinician and those groups are not exchangeable.

::: {.callout-note}
To expand on the above, assume that when a unit is randomised to revision and the clinical decision of what type of revision to do is based solely on disease severity with more severe units receiving one-stage and those that are less severe receive two-stage.
This violates the exchangeability assumption in that if $\mathbb{E}[Y|T = 1] = y_1$ and $\mathbb{E}[Y|T = 2] = y_2$ (with $Y$ denoting the observed outcomes and $T = 1$, $T = 2$ denoting receipt of one and two-stage) then we would not obtain the same expectations if the sets of treatment units were switched.
In other words, $\mathbb{E}[Y(1) | T = 1] \ne \mathbb{E}[Y(1) | T = 2] \ne \mathbb{E}[Y(1)]$ and $\mathbb{E}[Y(2) | T = 1] \ne \mathbb{E}[Y(2) | T = 2] \ne \mathbb{E}[Y(2)]$.
To remedy this, we adjust for a covariate set (in this example, disease severity but in the primary analysis we adjust for revision type preference and additional patient characteristics) with the goal of achieving conditional exchangeability.
:::


The following descriptions relate to the calculation of treatment effects (conditional log-odds-ratios) for the primary analysis.
All domains using g-computation and a Bayesian bootstrap to characterise the uncertainty in the covariate distribution.

### Surgical domain 

For the surgical domain, we calculate the effect of revision relative to debridement as the difference between a weighted sum of the log-odds of treatment success under one-stage and two-stage revision minus the log-odds of treatment success under debridement.

Specifically, we approximate the following (Riemann-Stieltjes) integrals based on the fitted values for the patients in the late-acute silo:

$$
\begin{aligned}
\mathbb{E}[\hat{\eta}(d_1 = 1, d_2 = 1, d_3 = 1, l)] &= \int_{\mathcal{L}} \hat{\eta}(d_1 = 1, d_2 = 1, d_3 = 1, l) d \hat{P}_L(l) \\
\mathbb{E}[\hat{\eta}(d_1 = 2, d_2 = 1, d_3 = 1, r = 1, l)] &= \int_{\mathcal{L}} \hat{\eta}(d_1 = 2, d_2 = 1, d_3 = 1, r = 1, l) d\hat{P}_L(l) \\
\mathbb{E}[\hat{\eta}(d_1 = 3, d_2 = 1, d_3 = 1, r = 2, l)] &= \int_{\mathcal{L}} \hat{\eta}(d_1 = 3, d_2 = 1, d_3 = 1, r = 2, l) d\hat{P}_L(l) \\
\end{aligned}
$$

where $\hat{\eta}$ denotes the linear predictor function, $d_k$ denotes the interventions in the surgical ($k=1$), duration ($k=2$) and extended prophylaxis domains ($k=3$) with the surgical domain ($d_1$) indexes corresponding to debridement, one-stage and two-stage respectively. 
Preference for surgical type under revision is denoted by $r$ and, finally, $l$ denotes the remaining covariate set including preference where it is not explicitly conditioned on and **other domain level interventions** not fixed for the purposes of the comparison, site, time effects etc.
We compute the effect of revision relative to debridement as:

$$
\begin{aligned}
\Delta_{d_1[1]} &= \mathbb{E}[\hat{\eta}(d_1 = 2, d_2 = 1, d_3 = 1, r = 1, l)]\mathbb{E}[r = 1] + \\ 
  & \quad \mathbb{E}[\hat{\eta}(d_1 = 3, d_2 = 1, d_3 = 1, r = 2, l)]\mathbb{E}[r = 2]  - \\ 
  & \quad \mathbb{E}[\hat{\eta}(d_1 = 1, d_2 = 1, d_3 = 1, l)]
\end{aligned}
$$

where $\Delta_{d_1[1]}$ denotes the log-odds-ratio comparison of interest^[There is currently only one comparison of interest for each domain but the index gives us the ability to refer to others should the need arise.], $\mathbb{E}[r = 1]$ and $\mathbb{E}[r = 2]$ are the relevant weights based on the observed distribution of preference for revision type in the sample.

::: {.callout-note}
Question - Would it be more sensible to compute $\mathbb{E}[Y|\dots]$ from the inverse linke transformed linear predictor and then compute the log-odds ratios from there or is the above acceptable???
:::

### Antibiotic duration domain 

The antibiotic duration domain treatment effects are simpler to estimate than those in the surgical domain in that we can calculate the effect of 6 weeks of backbone antibiotic relative to 12 weeks directly.
To do so, we use methods analogous to those detailed above restricting to the subset revealed to randomised antibiotic duration, all of which would have received a one-stage revision and who would therefore have not entered into the extended prophylaxis domain.

### Extended prophylaxis domain 

For the extended prophylaxis domain we calculate the effect of 12 weeks of extended prophylaxis relative to none again using methods analogous to those detailed above.
The estimation procedure is restricted to the subset revealed to randomised extended prophylaxis, all of which would have received a two-stage revision and who would therefore have not entered into the antibiotic duration domain.

### Antibiotic choice domain

For the antibiotic choice domain we calculate the effect of the addition of rifampacin relative to none again using methods analogous to those detailed above.
The estimation process is restricted to the subset revealed to randomised antibiotic choice, with no restrictions on the entry into the other domains.


# Decision procedures

Trial decisions are made based on probabilities associated with the comparisons of interest as characterised by the model parameters discussed earlier.
In its current format, the trial considers:

+ superiority - indicating that an intervention is beneficial relative to a comparator
+ non-inferiority - indicating that an intervention is no worse than some clinically relevant threshold to a comparator 
+ futility - indicating a low probability with respect to a superiority or non-inferiority assessment, as applicable

The mathematical definitions of these quantities are provided below and a table of the thresholds currently in use is defined in @tbl-dec-thres.

```{r}
#| echo: FALSE
#| label: tbl-dec-thres
#| tbl-pos: H
#| tbl-cap: "Decision thresholds"

d_tbl <- tribble(
  ~ Domain, ~ Quantity, ~ Threshold, ~ Probability,
  "Surgical", "Superiority \n revision vs debridement", "$>0$", "$\\ge 0.99$",
  "Surgical", "Futility \n revision vs debridement", "$>\\log(1.2)$", "$\\le 0.05$",
  "Antibiotic duration", "Non-inferiority \n 6 weeks vs 12 weeks", "$> \\log(1/1.2)$", "$\\ge 0.99$",
  "Antibiotic duration", "Futility \n 6 weeks vs 12 weeks", "$<\\log(1/1.2)$", "$\\le 0.2$",
  "Extended prophylaxis", "Superiority \n 12 weeks vs none", "$>0$", "$\\ge 0.99$",
  "Extended prophylaxis", "Futility \n 12 weeks vs none", "$>\\log(1.2)$", "$\\le 0.05$",
  "Antibiotic choice", "Superiority \n rifampacin vs none", "$>0$", "$\\ge 0.99$",
  "Antibiotic choice", "Futility \n rifampacin vs none", "$>\\log(1.2)$", "$\\le 0.05$"
  )

kableExtra::kbl(
  d_tbl, format = "latex", align = c("l", "l", "l", "l"), escape = FALSE,
  col.names = c("Domain", "Quantity", "Comparison", "Probability threshold")) |>
  kable_paper("hover", full_width = F) |>
  kable_styling(latex_options = "scale_down") 
#  see above comment - do not use hold_position, use tbl-pos instead
#   kable_styling(latex_options = "hold_position")
```

The actions that occur when decision threshold are met have been detailed in the core protocol and will not be duplicated here.
However, any occurrence of a futility decision requires that a subgroup analysis as per the populations listed in @sec-subgroups using the methods detailed in @sec-subgroup-analyses for the relevant domain(s).
For a futility decision to hold, it is expected that all relevant subgroups would show futility.

## Superiority

Superiority implies that an intervention has high probability of being beneficial relative to a comparator intervention.
Generally, superiority is a probability assessment against zero.
For any of the treatment effect parameters obtained from the primary analysis results we define:

$$
\begin{aligned}
\mathbb{I}_{d_k[c]}^\text{sup} = \text{Pr}(\Delta_{d_k[c]} > s_{d_k[c]}) \ge \gamma_{d_k[c]}^\text{sup}
\end{aligned}
$$

as treatment superiority where $\mathbb{I}_{d_k[c]}^\text{sup}$ is a boolean indicator of superiority, for the comparison indexed by $c$ within the $d_k$ domain relative to a reference level $s_{d_k[c]}$ (generally zero) at a probability greater than or equal to $\gamma_{d_k[c]}^\text{sup}$.

## Non-inferiority

Non-inferiority implies that an intervention has a high probability of being no worse than some pre-specified clinical threshold relative to the comparator intervention.
Generally, non-inferiority is a probability assessment against $\log(1/1.2)$.
For any of the treatment effect parameters obtained from the primary analysis results we define:

$$
\begin{aligned}
\mathbb{I}_{d_k[c]}^\text{ni} = \text{Pr}(\Delta_{d_k[c]} > n_{d_k[c]}) \ge \gamma_{d_k[c]}^\text{ni}
\end{aligned}
$$

as treatment non-inferiority where $\mathbb{I}_{d_k[c]}^\text{ni}$ is a boolean indicator of non-inferiority, for the comparison indexed by $c$ within the $d_k$ domain relative to a reference level $n_{d_k[c]}$ at a probability greater than or equal to $\gamma_{d_k[c]}^\text{ni}$.

## Futility

Futility with respect to a superiority or non-inferiority assessment implies that an intervention has low probability relative to the comparator intervention with respect to that assessment.
Generally, non-inferiority is a probability assessment against $\log(1.2)$.
For any of the treatment effect parameters obtained from the primary analysis results we define:

$$
\begin{aligned}
\mathbb{I}_{d_k[c]}^\text{fut} = \text{Pr}(\Delta_{d_k[c]} > f_{d_k[c]}) \le \gamma_{d_k[c]}^\text{fut}
\end{aligned}
$$

as treatment futility where $\mathbb{I}_{d_k[c]}^\text{fut}$ is a boolean indicator of futility with respect to the superiority assessement, for the comparison indexed by $c$ within the $d_k$ domain relative to a reference level $f_{d_k[c]}$ (generally $\log(1.2)$) at a probability greater than or equal to $\gamma_{d_k[c]}^\text{fut}$.


# Adaptation

Three possible adaptations are currently identified, namely early stopping (due to superiority, non-inferiority or futility), the addition of interventions within existing domains and the addition of entirely new domains.


# Simulation results

## Enrolment progression at sequential analyses (todo)


# References

<!-- Needs to have a citation for this to work otherwise you will get the old \end{CSLReferences} error  -->

::: {#refs}
:::
